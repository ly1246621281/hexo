---
categories:
  - UPMP
---
# 运维工具

运维工具页面是为研发维护线上数据而做的页面，目的是维护线上数据。因此风险系数有点高，注意规范小心使用。

## 1.运维工具汇总

运维工具供开发，测试维护生产，统一在权限系统内授权为Root用户，后续若有需求可自行开发维护相应功能。

## 2.运维工具 - 数据库操作

### 2.1 数据库相关操作。

**db1（11.22.6.48）** **db2(172.20.143.105)** **JED(gateht62aext.jed.jddb.com)**

 * 数据库增删改，其他表结构/索引请走DBQUERY

     | 请求URL（POST） | http://ysasuat.jd.com/action/admin/sql/execute               | 数据类型 | 默认值                        |
     | --------------- | ------------------------------------------------------------ | -------- | ----------------------------- |
     | 入参1           | index                                                        | Integer  | 1                             |
     | 入参2           | sql                                                          | String   | select count(1) from activity |
     | 出参            | {    "success": true,    "index": 1,    "message": "[{\"count(1)\":1505}]"} |          |                               |
     
### 2.2 数据库业务操作。

 * sharding分表操作

     **URL（POST）**http://ysas.jd.com/action/admin/sharding/listShardingCount
     
     | 参数名      | 数据类型  | 默认值                 | 含义，备注                     |
     | ----------- | --------- | ---------------------- | ------------------------------ |
     | activityIds | Integer[] | []                     | 活动号列表（可选）             |
     | startTime   | String    | 2021-06-01 10:00:00    | 开始时间（可选）               |
| endTime     | String    | null                   | 结束时间（可选）与开始日期呼应 |
     | tableName   | String    | stat_order/stat_action | 表名（必填）                   |
     

**db2(172.20.143.105),db2为看板表。目前是读多写少**

 * db2按id进行相应删除

   **URL(POST)**  http://ysas.jd.com/action/admin/sharding/delDataBase2ById

   | 参数名    | 数据类型  | 默认值                 | 含义，备注                     |
| --------- | --------- | ---------------------- | ------------------------------ |
| ids       | Integer[] | [1,2,3]                | 索引号（可选）                 |
| startId   | Integer   | 1                      | 开始行号（可选）               |
| endId     | Integer   | null                   | 结束行号（可选）与开始行号呼应 |
| tableName | String    | board_push_data_finish | 表名                           |

 * db2按id进行相应更新

     **URL(POST) ** http://ysas.jd.com/action/admin/sharding/updateDataBase2ById

     {"ids":[5,6],"KeyValue":{"sharding_start_time":"2021-05-17 01:30:00.0","sharding_end_time":"2021-04-26 12:12:12"},"tableName":"board_push_data_finish"}

     | 参数名    | 数据类型           | 默认值                 | 含义，备注               |
     | --------- | ------------------ | ---------------------- | ------------------------ |
     | ids       | Integer[]          | [1,2,3]                | 索引号（可选）           |
     | KeyValue  | Map<String,String> |                        | 待更新列和对应值（可选） |
     |           |                    |                        | columnKey，columnValue   |
     | tableName | String             | board_push_data_finish | 表名                     |

## 3.运维工具 - 缓存操作

* 获取缓存key **URL(POST)** http://ysas.jd.com/action/admin/remoteCache/getObjectByKey

  ` content-type:text/plain `

* 删除缓存Key **URL(POST)** http://ysas.jd.com/action/admin/remoteCache/deleteCacheByKey

  ` content-type:text/plain `

* 批量获取缓存信息 **URL(GET)**http://ysasuat.jd.com/action/admin/remoteCache/getAllCacheByKeys?prefixKey=v001_skuId30Day_&orderIds=100013347868,100010087238,100008960041

* 批量删除缓存 **URL(GET)** http://ysasuat.jd.com/action/admin/remoteCache/delAllCacheByKeys?prefixKey=v001_skuId30Day_&orderIds=100013347868,100010087238,100008960041

* 批量插入缓存**URL()**  http://upmp-zs.jd.com/action/admin/remoteCache/insertBatchKeys

  | 参数名    | 数据类型     | 默认值    | 含义，备注 |
  | --------- | ------------ | --------- | ---------- |
  | prefixKey | String       | v001_pin_ | 缓存前缀   |
  | orderIds  | List<String> | a,b,vc    | 字符串列表 |
  | value     | String       | 1         | value      |

* 获取线上指定规则KEY集合 **URL(POST)** http://ysasuat.jd.com/action/admin/remoteCache/getAllKeys

  ` content-type:text/plain `
  
  **注：**
  
  form-data和application/x-www-form-urlencoded  content-Type：application/x-www-form-urlencoded（区别是一个支持文件流）
  
  raw   content-Type：application/json   content-Type：text/plain(区别 键值对，String指定为text)

## 4.运维工具 - 业务操作

### 1.人群包工具

导入pinstr至数据库，注意此操作不会修改活动类型  http://ysas.jd.com/action/admin/pinPackage/pinStr2db

导入文件至数据库，并将普通SKU活动类型转为圈人类型 http://ysas.jd.com/action/admin/pinPackage/pinFile2db

[人群PIN包导入CF文档](https://cf.jd.com/pages/viewpage.action?pageId=487518117)

### 2.库存工具

解锁库存（POST）http://ysas.jd.com/action/commodity/unlockStockByActivityId



加锁库存（暂无）



### 3. 大促日报支持工具

1.提供大促日报参考邮件，统计指标涵盖所有指标汇报项。

邮件每日凌晨3分计算昨日试用品业务指标以及00.00.00--01.00.00期间段分钟级TOP1峰值以及时刻点。

![image-20210610150924932](https://i.loli.net/2021/06/10/iJ9uI5pCtgWsZrn.png)

2.提供 直连主机 11.37.75.200 请求controller方式提供四个功能，灵活选择时间段内业务指标和UMP监控情况。

 1） 业务指标查询（查询一段时间的业务统计指标）

**URL (GET请求)**  /action/admin/umpMonitor/callReport?startTime=20210601000000&endTime=20210602000000

2)  UMP监控点查询

* UMP获取 时间段内峰值

  **URL(POST请求)**   /action/admin/umpMonitor/listTopOne

* UMP获取 时间段内所有调用量

  **URL(POST请求)**   /action/admin/umpMonitor/listTotalCount

* UMP获取 时间的环比值

  **URL(POST请求)**  /action/admin/umpMonitor/listRatio

  | 参数名     | 数据类型 | 默认值                                   | 含义，备注                          |
  | ---------- | -------- | ---------------------------------------- | ----------------------------------- |
  | umpKey     | String   | jmq/jsf                                  | umpKey可填真实UMPkey                |
  | startTime1 | String   | 20210601000000                           | 开始日期                            |
  | endTime1   | String   | 20210601010000                           | 结束日期                            |
  | dateType   | String   | second，oneMinute，fiveMinute，hour，day | 分别表示秒，1分钟，5分钟，1小时和天 |
  | startTime2 | String   |                                          | 计算环比调用量，日期，（可选）      |
  | endTime2   | String   |                                          |                                     |

  ==注：dateType选择时注意1）分钟级时开始时间和结束时间需在一个小时内。2）秒级需注意需要5分钟内。==



