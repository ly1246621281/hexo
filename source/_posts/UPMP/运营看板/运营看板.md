---
categories:
  - UPMP
  - 运营看板
---
# 运营看板

* 核心指标汇总

```sql
select
	sum(t.activity_actual_total) as sum_actual_total ,
	sum(t.send_income) as sum_send_income ,
	sum(t.plan_send_count) as sum_plan_send_count,
	( cast( sum(t.activity_actual_total) as decimal(15, 2) ) / cast( sum(t.plan_send_count) as decimal(15, 2) ) ) as send_schedule ,
	( cast( sum(t.activity_actual_total) as decimal(15, 2) ) / cast( sum(plan_send_total_day) as decimal(15, 2) ) ) as send_efficiency
from
	(
	select
		sum(real_send_count) as activity_actual_total , send_income , plan_send_count , sum(plan_send_count_day) as plan_send_total_day
	from
		board_activity
	where
		send_type = 1
		and ( activity_dt between DATE_FORMAT( '2020-10-18 18:43:11.0', '%Y-%m-%d') and DATE_FORMAT( '2020-10-18 18:43:11.0', '%Y-%m-%d') )
	group by
		activity_id ) as t;
```

* 派发进度

```
select sum(t.activity_actual_total) as sum_actual_total , sum(t.send_income) as sum_send_income , sum(t.plan_send_count) as sum_plan_send_count, ( cast( sum(t.activity_actual_total) AS decimal(15,2) ) / cast( sum(t.plan_send_count) AS decimal(15,2) ) ) as send_schedule , ( cast( sum(t.activity_actual_total) as decimal(15,2) ) / cast( sum(plan_send_total_day) AS decimal(15,2) ) ) as send_efficiency FROM(
 SELECT sum(real_send_count) as activity_actual_total , send_income , plan_send_count , sum(plan_send_count_day) as plan_send_total_day
 FROM board_activity
 WHERE send_type = 1 and ( activity_dt between DATE_FORMAT( '2020-10-17 18:43:11.0','%Y-%m-%d') and DATE_FORMAT( '2020-10-17 18:43:11.0','%Y-%m-%d') ) group by activity_id ) as t;
```

* 核心指标下钻

```sql
		select
	activity_id as 'activityId',
	count(userCount) as 'realSendTotal',
	send_income as 'sendIncome',
	count(isDealUser) as 'dealUsers',
	sum(target_brand_amount) as 'targetBrandSale',
	sum(target_sku_amount) as 'targetProductSale',
	if(sum(isSendUser) != 0, sum(isDealUser)/ sum(isSendUser), null) as 'dealRate',
	sum(newUserCount) as 'dealNewUsers'
from
	(
	select
		activity_id, user_log_acct as 'userCount', if(sum(is_send_trial_sku)>= 1, 1, 0) as 'isSendUser', if(sum(is_deal_target_brand)>= 1, 1, 0) as 'isDealUser', if(min(user_type)= 1, 1, 0) as 'newUserCount', send_income, sum(target_brand_amount) as 'target_brand_amount', sum(target_sku_amount) as 'target_sku_amount'
	from
		board_activity_pin
	where
		date(send_date) between date('2020-10-18 18:43:11.0') and date('2020-10-18 18:43:11.0')
		and send_type = 1
		and activity_dt between date('2020-10-18 18:43:11.0') and date('2020-10-18 18:43:11.0')
		and activity_dt between date(start_time) and date_add(end_time, interval 60 day)
	group by
		activity_id, user_log_acct )t
group by
	activity_id
order by
	activityId desc
limit 0,20;
```

```sql
select
 activityId,
 a.activity_actual_total as 'realSendTotal',
 send_income as 'sendIncome',
 dealUsers,
 targetBrandSale,
 targetProductSale,
 dealNewUsers,
 if(sendUser != 0, dealUsers / sendUser, null) as 'dealRate'
from
 (
 select
  activity_id as 'activityId', sum(real_send_count) as activity_actual_total , send_income
 from
  board_activity
 where
  send_type = 1
  and activity_dt between DATE_FORMAT( ?, '%Y-%m-%d') and DATE_FORMAT( ?, '%Y-%m-%d')
 group by
  activity_id ) a
left join (
 select
  activity_id, count(distinct user_log_acct) as 'dealUsers', sum(target_brand_amount) as 'targetBrandSale'
 from
  board_activity_pin
 where
  date(send_date) between date(?) and date(?)
  and send_type = 1
  and activity_dt between date(?) and date(?)
  and activity_dt between date(start_time) and date_add(end_time, interval 60 day)
  and is_deal_target_brand = 1
 group by
  activity_id )b on
 a.activityId = b.activity_id
left join(
 select
  activity_id, count(distinct user_log_acct) as 'sendUser', sum(target_sku_amount) as 'targetProductSale'
 from
  board_activity_pin
 where
  date(send_date) between date(?) and date(?)
  and send_type = 1
  and activity_dt between date(?) and date(?)
  and activity_dt between date(start_time) and date_add(end_time, interval 60 day)
 group by
  activity_id )c on
 a.activityId = c.activity_id
left join(
 select
  activity_id, count(distinct user_log_acct) as 'dealNewUsers'
 from
  board_activity_pin
 where
  date(send_date) between date(?) and date(?)
  and send_type = 1
  and activity_dt between date(?) and date(?)
  and activity_dt between date(start_time) and date_add(end_time, interval 60 day)
  and is_deal_target_brand = 1
  and user_type = 1
 group by
  activity_id )d on
 a.activityId = d.activity_id
order by
 activityId desc
limit ?,
?
```



### 用户价值

* 用户-派发、购买金额、购买情况汇总

```sql
select count(distinct user_log_acct) as 'totalUserCount',sum(target_brand_sale_qtty) as 'totalDealCount', sum(target_brand_amount) as 'totalDealPrice'
 FROM board_activity_pin
 WHERE date(send_date) between date('2020-09-26 00:00:00.0') and date('2020-10-26 00:00:00.0') and send_type = 1 and activity_dt between date('2020-09-26 00:00:00.0') and date('2020-10-26 00:00:00.0') and activity_dt between date(start_time) and date_add(end_time, interval 60 day) and trial_sales_erp = 'bjyfwangkai' and is_deal_target_brand = 1;
```

* 用户分组

```sql
SELECT user_type ,count(distinct user_log_acct) as 'userCount',sum(target_brand_amount) as 'dealPrice',sum(target_brand_sale_qtty) as 'dealCount'
 FROM board_activity_pin
 WHERE date(send_date) between date('2020-09-26 00:00:00.0') and date('2020-10-26 00:00:00.0') and send_type = 1 and activity_dt between date('2020-09-26 00:00:00.0') and date('2020-10-26 00:00:00.0') and activity_dt between date(start_time) and date_add(end_time, interval 60 day) and trial_sales_erp = 'bjyfwangkai' and is_deal_target_brand = 1 group by user_type;

```

* 下钻--用户销售量

```sql
select a.activity_id as 'activityId',a.dealCount as 'dealUser', if(a.dealCount != 0, b.dealCount / a.dealCount, null) as 'dealNewUser', if(a.dealCount != 0, c.dealCount / a.dealCount, null) as 'dealAwakenUser', if(a.dealCount != 0, d.dealCount / a.dealCount, null) as 'dealAwakenOldUser'
 FROM (
 SELECT activity_id, count(distinct user_log_acct) as 'total',sum(target_brand_sale_qtty) as 'dealCount'
 FROM board_activity_pin
 WHERE date(send_date) between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and send_type = 1 and activity_dt between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and activity_dt between date(start_time) and date_add(end_time, interval 60 day) and trial_sales_erp = 'bjyfwangkai' and is_deal_target_brand = 1 group by activity_id )a
 LEFT JOIN (
 SELECT activity_id, count(distinct user_log_acct) as 'total',sum(target_brand_sale_qtty) as 'dealCount'
 FROM board_activity_pin
 WHERE date(send_date) between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and send_type = 1 and activity_dt between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and activity_dt between date(start_time) and date_add(end_time, interval 60 day) and trial_sales_erp = 'bjyfwangkai' and is_deal_target_brand = 1 and user_type = 1 group by activity_id )b
 ON a.activity_id=b.activity_id
 LEFT JOIN (
 SELECT activity_id, count(distinct user_log_acct) as 'total',sum(target_brand_sale_qtty) as 'dealCount'
 FROM board_activity_pin
 WHERE date(send_date) between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and send_type = 1 and activity_dt between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and activity_dt between date(start_time) and date_add(end_time, interval 60 day) and trial_sales_erp = 'bjyfwangkai' and is_deal_target_brand = 1 and user_type = 2 group by activity_id )c
 ON a.activity_id=c.activity_id
 LEFT JOIN (
 SELECT activity_id, count(distinct user_log_acct) as 'total',sum(target_brand_sale_qtty) as 'dealCount'
 FROM board_activity_pin
 WHERE date(send_date) between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and send_type = 1 and activity_dt between date('2020-09-01 12:00:09.0') and date('2020-09-24 12:00:09.0') and activity_dt between date(start_time) and date_add(end_time, interval 60 day) and trial_sales_erp = 'bjyfwangkai' and is_deal_target_brand = 1 and user_type = 3 group by activity_id )d
 ON a.activity_id=d.activity_id order by activityId desc, activityId desc
 LIMIT 0, 20;
```

