---
categories:
  - UPMP
---
# 试用品提单



## 1.提单接口

> 1.判断 提单渠道bizType （0依赖商品信息 ，1依赖活动信息为主）
>
> 2.判断 提单类型（普通类型，虚拟组套类型，其他扩展类型）
>
> 3.提单

## 2. 本次主要对依赖活动项提单改造

> 1.前置校验
>
> * 必要校验
> * 增加缓存库存量校验
> * 增加单仓限制缓存校验
>
> 2.沿用原有流程，先扣减库存后续提单
>
> * 提单确定提单类型（查activityParam表是否虚拟组套字段-- 主数据字段对比）
>
> * 下单（若为虚拟组套商品时 子商品去activityParam）
>
> 3.后续持久化：
>
> * 120天缓存放置
> * 活动和pin的映射关系 100day
> * 仓库限制（rest_count量和单仓量）
>
> * **不放当日pin缓存和1.5成功缓存**
> * 异步落库要修改短信模板
> * 逆向：回滚库存+移除120缓存

## 3. 根据SKU提单（后期扩展）

> 1.前置校验
>
> 2.根据SKU确定提单类型（后续可能按其他信息确定提单类型）
>
> * 提单类型：虚拟组套时读取商品主数据识别是否为组套商品
>
> 3.提单
>
> * 若为组套提单类型，需调用商品主数据读取实物SKU列表
> * 后续其他业务扩展
>
> 4.落库
>
> * 只插入OrderRecord记录；后续业务扩展





## 4. 其他工作

> 1. 短信模板
> 2. 不露出楼层和push消息
> 3. 逆向取消应该不需改动
> 4. 库存不足时暂停活动，告知业务

![image-20210806221143012](https://raw.githubusercontent.com/ly1246621281/PicGo/main/img/image-20210806221143012.png)