---
categories:
  - JAVA总结
  - JAVA（2020--2023）
---
# 数据库更新行行锁问题

## 1.Mysql自动提交机制

```sql
  set autocommit=0;   设置
   select @@autocommit;   查看或者  show variables like 'AUTOCOMMIT';
   注意： 只在当前IDE界面生效
```

除了以上设置，可由`begin；`开始，或者`**start transaction;**`

[MySQL事务语法学习](https://blog.csdn.net/hju22/article/details/86651973)

## 2.事务针对Update行锁/表锁分析

[MySQL执行update语句是锁行还是锁表分析](https://www.suibibk.com/topic/771792414850416640)

```sql
  begin;
                       
   update warehouse_dist set rest_count=rest_count +1,update_time = now() where  activity_id = 21841  and store_id = 90 and rest_count >0
           
      update temp_data set data_id  = 10 where create_by  = '2021-10-31'
           
  commit;
          
  rollback;
          
  select * from warehouse_dist wd where activity_id = 21841
```

IDE1里执行完SQL 不提交，IDE2里执行另一事务SQL，看是否等待。然后在IDE3里查看是否执行成功。

结论：

1.当前sql不走索引时，表锁

2.当前sql走索引时，行锁

3.联合索引和是否走索引有关，不走索引则会锁全表，走一个字段-> 行锁

## 3.事务介绍

针对 insert.update.delete语句

[菜鸟mysql事务](https://www.runoob.com/mysql/mysql-transaction.html)